<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ré(GE)nère - Plateforme d'Écosystème Mutualisé</title>
    <!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
  (function() {
    emailjs.init("GX0U6Fx-DT8e7v6xo");
  })();
</script>
    <style>
        /* Styles généraux */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f7f9fc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background-color: #2A9D8F;
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            margin: 0;
            font-size: 2.2rem;
        }
        
        header h2 {
            margin: 0;
            font-weight: normal;
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        nav {
            background-color: #264653;
            color: white;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        nav li {
            padding: 15px 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
        }
        
        nav a:hover {
            text-decoration: underline;
        }
        
        /* Sections */
        section {
            padding: 50px 0;
        }
        
        section h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #264653;
        }
        
        .intro {
            background-color: #E9C46A;
            color: #264653;
        }
        
        .intro p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .benefits {
            background-color: white;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .benefit-card {
            background-color: #f7f9fc;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .benefit-card:hover {
            transform: translateY(-5px);
        }
        
        .benefit-card h3 {
            color: #2A9D8F;
            margin-top: 0;
        }
        
        .how-it-works {
            background-color: #f7f9fc;
        }
        
        .steps {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .step {
            display: flex;
            margin-bottom: 40px;
            align-items: center;
        }
        
        .step-number {
            background-color: #E76F51;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .registration {
            background-color: white;
        }
        
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #f7f9fc;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #264653;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .submit-btn {
            background-color: #2A9D8F;
            color: white;
            border: none;
            padding: 14px 24px;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .submit-btn:hover {
            background-color: #238C7F;
        }
        
        footer {
            background-color: #264653;
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        footer a {
            color: #E9C46A;
        }
        
        /* Nouveaux styles pour les fonctionnalités d'édition */
        .profile-btn {
            background-color: #F4A261;
            color: #264653;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .profile-btn:hover {
            background-color: #E76F51;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }
        
        .edit-btn {
            background: none;
            border: none;
            color: #2A9D8F;
            cursor: pointer;
            font-size: 1.2rem;
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .edit-btn:hover {
            color: #E76F51;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .export-btn {
            background-color: #264653;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            margin-top: 20px;
        }
        
        .export-btn:hover {
            background-color: #1A323E;
        }
        
        .data-notice {
            margin-top: 30px;
            padding: 15px;
            background-color: #FDF5E8;
            border-left: 4px solid #F4A261;
            border-radius: 4px;
        }
        
        .profile-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .hidden {
            display: none;
        }
        
        .save-btn {
            background-color: #2A9D8F;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
        }
        
        .save-btn:hover {
            background-color: #238C7F;
        }
        
        /* Styles pour les tags et sélections de catégories */
        .category-select {
            margin-bottom: 15px;
        }
        
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tag {
            background-color: #E9C46A;
            color: #264653;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
        }
        
        .tag .remove-tag {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .add-category-btn {
            background-color: #2A9D8F;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .multi-select {
            margin-top: 15px;
        }
        
        /* Styles pour les détails d'échange */
        .exchange-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .exchange-details div {
            margin-bottom: 10px;
        }

        .exchange-details label {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 5px;
        }

        .exchange-details select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .exchange-details-container {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 5px;
            border-left: 3px solid #2A9D8F;
        }
    </style>
</head>
<body>
    <!-- Modal de connexion -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('loginModal')">&times;</span>
            <h2>Accéder à mon profil</h2>
            <p>Veuillez entrer l'email professionnel utilisé lors de l'inscription.</p>
            <div class="form-group">
                <label for="loginEmail">Email professionnel</label>
                <input type="email" id="loginEmail" required>
            </div>
            <button class="submit-btn" onclick="loginProfile()">Accéder à mon profil</button>
        </div>
    </div>
    
    <!-- Modal du profil -->
    <div id="profileModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close-btn" onclick="closeModal('profileModal')">&times;</span>
            <h2>Profil de l'entreprise</h2>
            <div id="profileContent">
                <!-- Section d'information d'entreprise -->
                <div class="profile-section">
                    <div class="section-title">
                        <h3>Informations de l'entreprise</h3>
                        <button class="edit-btn" onclick="toggleEdit('company-info')">✏️</button>
                    </div>
                    
                    <div id="company-info-display">
                        <!-- Informations affichées ici -->
                    </div>
                    
                    <div id="company-info-edit" class="hidden">
                        <div class="form-group">
                            <label for="editName">Nom de l'entreprise</label>
                            <input type="text" id="editName">
                        </div>
                        <div class="form-group">
                            <label for="editAddress">Adresse</label>
                            <input type="text" id="editAddress">
                        </div>
                        <div class="form-group">
                            <label for="editZip">Code postal</label>
                            <input type="text" id="editZip">
                        </div>
                        <div class="form-group">
                            <label for="editCity">Ville</label>
                            <input type="text" id="editCity">
                        </div>
                        <div class="form-group">
                            <label for="editWebsite">Site web</label>
                            <input type="url" id="editWebsite">
                        </div>
                        <button class="save-btn" onclick="saveSection('company-info')">Enregistrer les modifications</button>
                    </div>
                </div>
                
                <!-- Section des ressources -->
                <div class="profile-section">
                    <div class="section-title">
                        <h3>Ressources disponibles</h3>
                        <button class="edit-btn" onclick="toggleEdit('resources')">✏️</button>
                    </div>
                    
                    <div id="resources-display">
                        <!-- Ressources affichées ici -->
                    </div>
                    
                    <div id="resources-edit" class="hidden">
                        <div class="form-group">
                            <label>Catégories de ressources</label>
                            <div id="resources-categories-container">
                                <!-- Catégories sélectionnées s'afficheront ici -->
                            </div>
                            <div class="category-select">
                                <select id="resourceCategorySelect">
                                    <option value="">Sélectionnez une catégorie</option>
                                    <!-- Catégories remplies par JavaScript -->
                                </select>
                                <button type="button" class="add-category-btn" onclick="addCategory('resource')">Ajouter</button>
                            </div>
                        </div>
                        
                        <div class="form-group exchange-details-container">
                            <label>Modalités d'échange (pour ressources immatérielles)</label>
                            <div class="exchange-details">
                                <div>
                                    <label for="editResourceFrequency">Fréquence</label>
                                    <select id="editResourceFrequency">
                                        <option value="">Sélectionnez</option>
                                        <option value="ponctuel">Ponctuel</option>
                                        <option value="regulier">Régulier</option>
                                        <option value="demande">Sur demande</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="editResourceMode">Mode d'échange</label>
                                    <select id="editResourceMode">
                                        <option value="">Sélectionnez</option>
                                        <option value="presentiel">En présentiel</option>
                                        <option value="distance">À distance</option>
                                        <option value="mixte">Mixte</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="editResourceExpertise">Niveau d'expertise</label>
                                    <select id="editResourceExpertise">
                                        <option value="">Sélectionnez</option>
                                        <option value="initiation">Initiation</option>
                                        <option value="intermediaire">Intermédiaire</option>
                                        <option value="expert">Expert</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="editResources">Description détaillée</label>
                            <textarea id="editResources" rows="4" placeholder="Décrivez en détail les ressources que vous offrez, incluant fréquence, modalités et conditions..."></textarea>
                        </div>
                        <button class="save-btn" onclick="saveSection('resources')">Enregistrer les modifications</button>
                    </div>
                </div>
                
                <!-- Section des besoins -->
                <div class="profile-section">
                    <div class="section-title">
                        <h3>Besoins recherchés</h3>
                        <button class="edit-btn" onclick="toggleEdit('needs')">✏️</button>
                    </div>
                    
                    <div id="needs-display">
                        <!-- Besoins affichés ici -->
                    </div>
                    
                    <div id="needs-edit" class="hidden">
                        <div class="form-group">
                            <label>Catégories de besoins</label>
                            <div id="needs-categories-container">
                                <!-- Catégories sélectionnées s'afficheront ici -->
                            </div>
                            <div class="category-select">
                                <select id="needCategorySelect">
                                    <option value="">Sélectionnez une catégorie</option>
                                    <!-- Catégories remplies par JavaScript -->
                                </select>
                                <button type="button" class="add-category-btn" onclick="addCategory('need')">Ajouter</button>
                            </div>
                        </div>
                        
                        <div class="form-group exchange-details-container">
                            <label>Modalités d'échange (pour besoins immatériels)</label>
                            <div class="exchange-details">
                                <div>
                                    <label for="editNeedFrequency">Fréquence</label>
                                    <select id="editNeedFrequency">
                                        <option value="">Sélectionnez</option>
                                        <option value="ponctuel">Ponctuel</option>
                                        <option value="regulier">Régulier</option>
                                        <option value="demande">Sur demande</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="editNeedMode">Mode d'échange</label>
                                    <select id="editNeedMode">
                                        <option value="">Sélectionnez</option>
                                        <option value="presentiel">En présentiel</option>
                                        <option value="distance">À distance</option>
                                        <option value="mixte">Mixte</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="editNeedExpertise">Niveau d'expertise</label>
                                    <select id="editNeedExpertise">
                                        <option value="">Sélectionnez</option>
                                        <option value="initiation">Initiation</option>
                                        <option value="intermediaire">Intermédiaire</option>
                                        <option value="expert">Expert</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="editNeeds">Description détaillée</label>
                            <textarea id="editNeeds" rows="4" placeholder="Décrivez en détail les ressources dont vous avez besoin, incluant fréquence, modalités et conditions..."></textarea>
                        </div>
                        <button class="save-btn" onclick="saveSection('needs')">Enregistrer les modifications</button>
                    </div>
                </div>
                
                <!-- Section des préférences -->
                <div class="profile-section">
                    <div class="section-title">
                        <h3>Préférences de notification</h3>
                        <button class="edit-btn" onclick="toggleEdit('preferences')">✏️</button>
                    </div>
                    
                    <div id="preferences-display">
                        <!-- Préférences affichées ici -->
                    </div>
                    
                    <div id="preferences-edit" class="hidden">
                        <div class="form-group">
                            <label for="editPreferences">Préférences de notification</label>
                            <select id="editPreferences">
                                <option value="all">Toutes les correspondances</option>
                                <option value="weekly">Résumé hebdomadaire</option>
                                <option value="important">Correspondances importantes uniquement</option>
                                <option value="none">Aucune notification</option>
                            </select>
                        </div>
                        <button class="save-btn" onclick="saveSection('preferences')">Enregistrer les modifications</button>
                    </div>
                </div>
                
                <button class="export-btn" onclick="exportData()">📥 Exporter mes données</button>
                
                <div class="data-notice">
                    <p><strong>⚠️ Important :</strong> Vos données sont stockées localement sur cet appareil uniquement. Pour éviter toute perte d'information en cas de changement d'appareil ou de navigateur, veuillez utiliser le bouton "Exporter mes données" et conserver ce fichier en lieu sûr.</p>
                </div>
            </div>
        </div>
    </div>

    <header>
        <div class="container">
            <div>
                <h1>Ré(GE)nère</h1>
                <h2>Plateforme d'Écosystème Mutualisé - Genève</h2>
            </div>
            <button class="profile-btn" onclick="openModal('loginModal')">👤 Accéder à mon profil</button>
        </div>
    </header>
    
    <nav>
        <div class="container">
            <ul>
                <li><a href="#intro">Accueil</a></li>
                <li><a href="#benefits">Avantages</a></li>
                <li><a href="#how">Comment ça marche</a></li>
                <li><a href="#register">S'inscrire</a></li>
            </ul>
        </div>
    </nav>
    
   <section id="intro" class="intro">
    <div class="container">
        <h2>Créons un écosystème durable. Mutualisons nos ressources !</h2>
        <p>Ré(GE)nère connecte les entreprises genevoises pour créer des synergies locales, valoriser les déchets et optimiser l'utilisation des ressources dans une démarche d'économie locale.</p>
    </div>
</section>
    
    <section id="benefits" class="benefits">
        <div class="container">
            <h2>Pourquoi rejoindre notre écosystème ?</h2>
            <div class="benefits-grid">
                  <div class="benefit-card">
                    <h3>Réseautage local</h3>
                    <p>Développez votre réseau professionnel en collaborant avec d'autres entreprises genevoises partageant vos valeurs.</p>
                </div>
                <div class="benefit-card">
                    <h3>Économies significatives</h3>
                    <p>Réduisez vos coûts d'élimination des déchets et trouvez des ressources à moindre coût auprès d'autres entreprises locales.</p>
                </div>
                <div class="benefit-card">
                    <h3>Impact environnemental positif</h3>
                    <p>Contribuez à réduire l'empreinte carbone de votre entreprise en donnant une seconde vie à vos ressources inutilisées.</p>
                </div>
                <div class="benefit-card">
                    <h3>Image responsable</h3>
                    <p>Renforcez votre image d'entreprise engagée dans le développement durable et l'économie locale.</p>
                </div>
                <div class="benefit-card">
                    <h3>Innovation collaborative</h3>
                    <p>Découvrez de nouvelles façons d'utiliser vos ressources et inspirez-vous des pratiques d'autres entreprises.</p>
                </div>
                <div class="benefit-card">
                    <h3>Simplicité d'utilisation</h3>
                    <p>Une plateforme intuitive pour publier vos offres et demandes, et être mis en relation automatiquement avec des correspondances pertinentes.</p>
                </div>
            </div>
        </div>
    </section>
    
    <section id="how" class="how-it-works">
        <div class="container">
            <h2>Comment ça marche</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Inscrivez votre entreprise</h3>
                        <p>Remplissez le formulaire d'inscription avec les informations de votre entreprise. C'est gratuit et prend moins de 5 minutes.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Publiez vos ressources et besoins</h3>
                        <p>Indiquez les ressources que vous pouvez offrir (déchets, matériaux, équipements, espaces, compétences) et celles dont vous avez besoin.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Recevez des correspondances</h3>
                        <p>Notre algorithme identifie automatiquement les entreprises dont les besoins correspondent à vos ressources, et vice-versa.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Collaborez localement</h3>
                        <p>Entrez en contact avec les entreprises suggérées et établissez des partenariats bénéfiques pour tous, dans une logique d'économie locale.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="register" class="registration">
        <div class="container">
            <h2>Inscrivez votre entreprise</h2>
            <div class="form-container">
                <form id="registrationForm">
                    <div class="form-group">
                        <label for="companyName">Nom de l'entreprise*</label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Adresse*</label>
                        <input type="text" id="address" required>
                    </div>
                    <div class="form-group">
                        <label for="zipCode">Code postal*</label>
                        <input type="text" id="zipCode" required>
                    </div>
                    <div class="form-group">
                        <label for="city">Ville*</label>
                        <input type="text" id="city" required>
                    </div>
                    <div class="form-group">
                        <label for="website">Site web</label>
                        <input type="url" id="website">
                    </div>
                    <div class="form-group">
                        <label for="email">Email professionnel*</label>
                        <input type="email" id="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Catégories de ressources disponibles*</label>
                        <div id="register-resources-categories" class="tag-container"></div>
                        <div class="category-select">
                            <select id="registerResourceSelect">
                                <option value="">Sélectionnez une catégorie</option>
                                <!-- Catégories remplies par JavaScript -->
                            </select>
                            <button type="button" class="add-category-btn" onclick="addRegistrationCategory('resource')">Ajouter</button>
                        </div>
                    </div>
                    
                    <div class="form-group exchange-details-container">
                        <label>Modalités d'échange (pour ressources immatérielles)</label>
                        <div class="exchange-details">
                            <div>
                                <label for="resourceFrequency">Fréquence</label>
                                <select id="resourceFrequency">
                                    <option value="">Sélectionnez</option>
                                    <option value="ponctuel">Ponctuel</option>
                                    <option value="regulier">Régulier</option>
                                    <option value="demande">Sur demande</option>
                                </select>
                            </div>
                            <div>
                                <label for="resourceMode">Mode d'échange</label>
                                <select id="resourceMode">
                                    <option value="">Sélectionnez</option>
                                    <option value="presentiel">En présentiel</option>
                                    <option value="distance">À distance</option>
                                    <option value="mixte">Mixte</option>
                                </select>
                            </div>
                            <div>
                                <label for="resourceExpertise">Niveau d'expertise</label>
                                <select id="resourceExpertise">
                                    <option value="">Sélectionnez</option>
                                    <option value="initiation">Initiation</option>
                                    <option value="intermediaire">Intermédiaire</option>
                                    <option value="expert">Expert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="resources">Description des ressources disponibles*</label>
                        <textarea id="resources" rows="4" required placeholder="Exemples : 2h de conseil en stratégie durable par mois, atelier de méditation hebdomadaire, 15kg de carton recyclé chaque semaine, salle de réunion disponible les vendredis..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Catégories de besoins recherchés*</label>
                        <div id="register-needs-categories" class="tag-container"></div>
                        <div class="category-select">
                            <select id="registerNeedSelect">
                                <option value="">Sélectionnez une catégorie</option>
                                <!-- Catégories remplies par JavaScript -->
                            </select>
                            <button type="button" class="add-category-btn" onclick="addRegistrationCategory('need')">Ajouter</button>
                        </div>
                    </div>
                    
                    <div class="form-group exchange-details-container">
                        <label>Modalités d'échange (pour besoins immatériels)</label>
                        <div class="exchange-details">
                            <div>
                                <label for="needFrequency">Fréquence</label>
                                <select id="needFrequency">
                                    <option value="">Sélectionnez</option>
                                    <option value="ponctuel">Ponctuel</option>
                                    <option value="regulier">Régulier</option>
                                    <option value="demande">Sur demande</option>
                                </select>
                            </div>
                            <div>
                                <label for="needMode">Mode d'échange</label>
                                <select id="needMode">
                                    <option value="">Sélectionnez</option>
                                    <option value="presentiel">En présentiel</option>
                                    <option value="distance">À distance</option>
                                    <option value="mixte">Mixte</option>
                                </select>
                            </div>
                            <div>
                                <label for="needExpertise">Niveau d'expertise</label>
                                <select id="needExpertise">
                                    <option value="">Sélectionnez</option>
                                    <option value="initiation">Initiation</option>
                                    <option value="intermediaire">Intermédiaire</option>
                                    <option value="expert">Expert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="needs">Description des besoins recherchés*</label>
                        <textarea id="needs" rows="4" required placeholder="Exemples : Recherche expertise en marketing digital (2h/mois), besoin de palettes en bois, espace de stockage temporaire, formation en comptabilité..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="notifications">Préférences de notification</label>
                        <select id="notifications">
                            <option value="all">Toutes les correspondances</option>
                            <option value="weekly">Résumé hebdomadaire</option>
                            <option value="important">Correspondances importantes uniquement</option>
                            <option value="none">Aucune notification</option>
                        </select>
                    </div>
                    <button type="button" class="submit-btn" onclick="registerCompany()">S'inscrire</button>
                </form>
            </div>
        </div>
    </section>
    
    <footer>
    <div class="container">
        <p>&copy; 2025 Ré(GE)nère - Plateforme d'Écosystème Mutualisé Genève créée par l'Association Éclore</p>
        <p>Contact : <a href="mailto:info@eclore-asso.org">info@eclore-asso.org</a></p>
    </div>
</footer>

    <script>
        // Tableau complet des catégories
        const allCategories = [
            // Catégories matérielles
            { id: "matieres", name: "Matières premières" },
            { id: "papier", name: "Papier/Carton" },
            { id: "plastique", name: "Plastique" },
            { id: "metaux", name: "Métaux" },
            { id: "bois", name: "Bois" },
            { id: "textile", name: "Textile" },
            { id: "verre", name: "Verre" },
            { id: "organique", name: "Organiques" },
            { id: "electronique", name: "Électroniques" },
            { id: "equipement", name: "Équipements" },
            { id: "mobilier", name: "Mobilier" },
            { id: "espace", name: "Espaces" },
            { id: "transport", name: "Transport" },
            { id: "energie", name: "Énergie" },
            { id: "eau", name: "Eau" },
            
            // Catégories immatérielles (ajoutées)
            { id: "temps", name: "Temps et expertise" },
            { id: "conseil", name: "Conseil et accompagnement" },
            { id: "formation", name: "Formation et éducation" },
            { id: "bienetre", name: "Bien-être et développement personnel" },
            { id: "reseau", name: "Réseau et contacts" },
            { id: "competences", name: "Compétences spécifiques" },
            { id: "evenements", name: "Événements et rencontres" },
            { id: "services", name: "Services divers" },
            
            // Option pour ajouter une nouvelle catégorie
            { id: "autre", name: "Autre (proposer nouvelle catégorie)" }
        ];

        // Fonction pour remplir les menus déroulants avec toutes les catégories
        function populateCategoryDropdowns() {
            const dropdowns = ['registerResourceSelect', 'registerNeedSelect', 'resourceCategorySelect', 'needCategorySelect'];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    // Vider le dropdown sauf la première option
                    while (dropdown.options.length > 1) {
                        dropdown.options.remove(1);
                    }
                    
                    // Ajouter toutes les catégories existantes
                    allCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = category.name;
                        dropdown.appendChild(option);
                    });
                    
                    // Ajouter les catégories personnalisées enregistrées localement
                    const customCategories = JSON.parse(localStorage.getItem('customCategories') || '[]');
                    if (customCategories.length > 0) {
                        customCategories.forEach(category => {
                            if (!allCategories.some(c => c.name === category)) {
                                const option = document.createElement('option');
                                option.value = category;
                                option.textContent = category;
                                dropdown.appendChild(option);
                            }
                        });
                    }
                }
            });
        }

        // Fonction pour gérer l'ajout d'une nouvelle catégorie
        function handleNewCategory(selectId) {
            const select = document.getElementById(selectId);
            
            if (select.value === "Autre (proposer nouvelle catégorie)") {
                const newCategory = prompt("Veuillez saisir le nom de la nouvelle catégorie que vous souhaitez proposer:");
                
                if (newCategory && newCategory.trim()) {
                    // Vérifier si cette catégorie existe déjà
                    const allOptions = Array.from(select.options).map(opt => opt.value);
                    
                    if (!allOptions.includes(newCategory.trim())) {
                        // Ajouter au stockage local
                        const customCategories = JSON.parse(localStorage.getItem('customCategories') || '[]');
                        customCategories.push(newCategory.trim());
                        localStorage.setItem('customCategories', JSON.stringify(customCategories));
                        
                        // Ajouter au dropdown
                        const option = document.createElement('option');
                        option.value = newCategory.trim();
                        option.textContent = newCategory.trim();
                        select.add(option, 1); // Ajouter juste après la première option
                        
                        // Sélectionner la nouvelle catégorie
                        select.value = newCategory.trim();
                        
                        // Mettre à jour tous les dropdowns
                        populateCategoryDropdowns();
                        
                        return newCategory.trim();
                    } else {
                        alert("Cette catégorie existe déjà.");
                        select.value = ""; // Réinitialiser la sélection
                    }
                } else {
                    select.value = ""; // Réinitialiser la sélection
                }
            }
            
            return select.value;
        }
        
        // Variables pour stocker les catégories sélectionnées pendant l'inscription
        let registerResourceCategories = [];
        let registerNeedCategories = [];
        
        // Fonctions pour gérer les modals
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // Si on ouvre le profil, charger les données
            if (modalId === 'profileModal') {
                loadProfileData();
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Fermer le modal si on clique en dehors
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }
        
        // Fonction pour ajouter une catégorie dans le formulaire d'inscription
        function addRegistrationCategory(type) {
            const selectId = type === 'resource' ? 'registerResourceSelect' : 'registerNeedSelect';
            const containerId = type === 'resource' ? 'register-resources-categories' : 'register-needs-categories';
            const select = document.getElementById(selectId);
            const container = document.getElementById(containerId);
            const categoriesArray = type === 'resource' ? registerResourceCategories : registerNeedCategories;
            
            if (!select.value) return;
            
            // Gérer l'ajout d'une nouvelle catégorie
            const categoryValue = handleNewCategory(selectId);
            if (!categoryValue) return;
            
            if (!categoriesArray.includes(categoryValue)) {
                // Ajouter à l'array
                categoriesArray.push(categoryValue);
                
                // Créer le tag visuel
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = categoryValue + '<span class="remove-tag" onclick="removeRegistrationCategory(\'' + type + '\', \'' + categoryValue + '\')">✕</span>';
                container.appendChild(tag);
                
                // Réinitialiser le select
                select.value = '';
            }
        }
        
        // Fonction pour supprimer une catégorie dans le formulaire d'inscription
        function removeRegistrationCategory(type, category) {
            const containerId = type === 'resource' ? 'register-resources-categories' : 'register-needs-categories';
            const container = document.getElementById(containerId);
            let categoriesArray = type === 'resource' ? registerResourceCategories : registerNeedCategories;
            
            // Supprimer de l'array
            categoriesArray = categoriesArray.filter(item => item !== category);
            if (type === 'resource') {
                registerResourceCategories = categoriesArray;
            } else {
                registerNeedCategories = categoriesArray;
            }
            
            // Rafraîchir l'affichage
            refreshTagsContainer(containerId, categoriesArray, type);
        }
        
        // Rafraîchir l'affichage des tags
        function refreshTagsContainer(containerId, categoriesArray, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            categoriesArray.forEach(category => {
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = category + '<span class="remove-tag" onclick="removeRegistrationCategory(\'' + type + '\', \'' + category + '\')">✕</span>';
                container.appendChild(tag);
            });
        }
        
        // Fonction pour ajouter une catégorie dans le profil
        function addCategory(type) {
            const selectId = type === 'resource' ? 'resourceCategorySelect' : 'needCategorySelect';
            const select = document.getElementById(selectId);
            
            if (!select.value) return;
            
            // Gérer l'ajout d'une nouvelle catégorie
            const categoryValue = handleNewCategory(selectId);
            if (!categoryValue) return;
            
            const email = localStorage.getItem('currentLoggedIn');
            if (!email) return;
            
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const companyIndex = companies.findIndex(c => c.email === email);
            
            if (companyIndex !== -1) {
                const company = companies[companyIndex];
                
                // Initialiser les arrays si nécessaire
                if (!company.resourceCategories) company.resourceCategories = [];
                if (!company.needCategories) company.needCategories = [];
                
                const categoriesArray = type === 'resource' ? company.resourceCategories : company.needCategories;
                
                // Vérifier si la catégorie existe déjà
                if (!categoriesArray.includes(categoryValue)) {
                    categoriesArray.push(categoryValue);
                    
                    // Mettre à jour l'entreprise
                    if (type === 'resource') {
                        company.resourceCategories = categoriesArray;
                    } else {
                        company.needCategories = categoriesArray;
                    }
                    
                    companies[companyIndex] = company;
                    localStorage.setItem('companies', JSON.stringify(companies));
                    
                    // Rafraîchir l'affichage
                    updateCategoriesDisplay(type, categoriesArray);
                    
                    // Réinitialiser le select
                    select.value = '';
                }
            }
        }
        
        // Mettre à jour l'affichage des catégories
        function updateCategoriesDisplay(type, categories) {
            const containerId = type === 'resource' ? 'resources-categories-container' : 'needs-categories-container';
            const container = document.getElementById(containerId);
            
            container.innerHTML = '';
            
            if (categories && categories.length > 0) {
                const tagContainer = document.createElement('div');
                tagContainer.className = 'tag-container';
                
                categories.forEach(category => {
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.innerHTML = category + '<span class="remove-tag" onclick="removeCategory(\'' + type + '\', \'' + category + '\')">✕</span>';
                    tagContainer.appendChild(tag);
                });
                
                container.appendChild(tagContainer);
            }
        }
        
        // Supprimer une catégorie du profil
        function removeCategory(type, category) {
            const email = localStorage.getItem('currentLoggedIn');
            if (!email) return;
            
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const companyIndex = companies.findIndex(c => c.email === email);
            
            if (companyIndex !== -1) {
                const company = companies[companyIndex];
                
                if (type === 'resource' && company.resourceCategories) {
                    company.resourceCategories = company.resourceCategories.filter(c => c !== category);
                    updateCategoriesDisplay('resource', company.resourceCategories);
                } else if (type === 'need' && company.needCategories) {
                    company.needCategories = company.needCategories.filter(c => c !== category);
                    updateCategoriesDisplay('need', company.needCategories);
                }
                
                companies[companyIndex] = company;
                localStorage.setItem('companies', JSON.stringify(companies));
            }
        }
        
        // Fonction pour s'identifier et accéder au profil
        function loginProfile() {
            const email = document.getElementById('loginEmail').value;
            
            if (!email) {
                alert('Veuillez entrer votre email professionnel');
                return;
            }
            
            // Vérifier si l'entreprise existe dans le stockage local
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const company = companies.find(c => c.email === email);
            
            if (company) {
                // Stocker l'email actuellement connecté
                localStorage.setItem('currentLoggedIn', email);
                
                // Fermer le modal de login et ouvrir le profil
                closeModal('loginModal');
                openModal('profileModal');
            } else {
                alert("Aucune entreprise trouvée avec cet email. Veuillez vérifier votre adresse ou vous inscrire.");
            }
        }
        
        // Fonction pour charger les données du profil
        function loadProfileData() {
            const email = localStorage.getItem('currentLoggedIn');
            if (!email) return;
            
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const company = companies.find(c => c.email === email);
            
            if (company) {
                // Charger les informations de l'entreprise
                document.getElementById('company-info-display').innerHTML = `
                    <p><strong>Nom :</strong> ${company.name || ''}</p>
                    <p><strong>Adresse :</strong> ${company.address || ''}</p>
                    <p><strong>Code postal :</strong> ${company.zipCode || ''}</p>
                    <p><strong>Ville :</strong> ${company.city || ''}</p>
                    <p><strong>Site web :</strong> ${company.website || 'Non spécifié'}</p>
                    <p><strong>Email :</strong> ${company.email || ''}</p>
                `;
                
                // Charger les valeurs dans le formulaire d'édition
                document.getElementById('editName').value = company.name || '';
                document.getElementById('editAddress').value = company.address || '';
                document.getElementById('editZip').value = company.zipCode || '';
                document.getElementById('editCity').value = company.city || '';
                document.getElementById('editWebsite').value = company.website || '';
                
                // Charger les ressources
                let resourcesHtml = '';
                if (company.resourceCategories && company.resourceCategories.length > 0) {
                    resourcesHtml += '<p><strong>Catégories :</strong> ' + company.resourceCategories.join(', ') + '</p>';
                }
                
                resourcesHtml += `<p><strong>Description :</strong> ${company.resources || 'Aucune description'}</p>`;
                
                // Ajouter les modalités si elles existent
                if (company.resourceDetails) {
                    const modalitesMap = {
                        frequency: { 
                            label: 'Fréquence', 
                            values: { ponctuel: 'Ponctuel', regulier: 'Régulier', demande: 'Sur demande' } 
                        },
                        mode: { 
                            label: 'Mode d\'échange', 
                            values: { presentiel: 'En présentiel', distance: 'À distance', mixte: 'Mixte' } 
                        },
                        expertise: { 
                            label: 'Niveau d\'expertise', 
                            values: { initiation: 'Initiation', intermediaire: 'Intermédiaire', expert: 'Expert' } 
                        }
                    };
                    
                    let modalitesHtml = '<p><strong>Modalités d\'échange :</strong> ';
                    let modalitesDetails = [];
                    
                    for (const [key, config] of Object.entries(modalitesMap)) {
                        if (company.resourceDetails[key]) {
                            modalitesDetails.push(`${config.label}: ${config.values[company.resourceDetails[key]] || company.resourceDetails[key]}`);
                        }
                    }
                    
                    if (modalitesDetails.length > 0) {
                        modalitesHtml += modalitesDetails.join(', ');
                    } else {
                        modalitesHtml += 'Non spécifiées';
                    }
                    
                    modalitesHtml += '</p>';
                    resourcesHtml += modalitesHtml;
                }
                
                document.getElementById('resources-display').innerHTML = resourcesHtml;
                document.getElementById('editResources').value = company.resources || '';
                
                // Charger les modalités dans le formulaire d'édition des ressources
                if (company.resourceDetails) {
                    if (company.resourceDetails.frequency) 
                        document.getElementById('editResourceFrequency').value = company.resourceDetails.frequency;
                    if (company.resourceDetails.mode) 
                        document.getElementById('editResourceMode').value = company.resourceDetails.mode;
                    if (company.resourceDetails.expertise) 
                        document.getElementById('editResourceExpertise').value = company.resourceDetails.expertise;
                }
                
                // Mettre à jour l'affichage des catégories de ressources
                if (company.resourceCategories) {
                    updateCategoriesDisplay('resource', company.resourceCategories);
                }
                
                // Charger les besoins
                let needsHtml = '';
                if (company.needCategories && company.needCategories.length > 0) {
                    needsHtml += '<p><strong>Catégories :</strong> ' + company.needCategories.join(', ') + '</p>';
                }
                
                needsHtml += `<p><strong>Description :</strong> ${company.needs || 'Aucune description'}</p>`;
                
                // Ajouter les modalités si elles existent
                if (company.needDetails) {
                    const modalitesMap = {
                        frequency: { 
                            label: 'Fréquence', 
                            values: { ponctuel: 'Ponctuel', regulier: 'Régulier', demande: 'Sur demande' } 
                        },
                        mode: { 
                            label: 'Mode d\'échange', 
                            values: { presentiel: 'En présentiel', distance: 'À distance', mixte: 'Mixte' } 
                        },
                        expertise: { 
                            label: 'Niveau d\'expertise', 
                            values: { initiation: 'Initiation', intermediaire: 'Intermédiaire', expert: 'Expert' } 
                        }
                    };
                    
                    let modalitesHtml = '<p><strong>Modalités d\'échange :</strong> ';
                    let modalitesDetails = [];
                    
                    for (const [key, config] of Object.entries(modalitesMap)) {
                        if (company.needDetails[key]) {
                            modalitesDetails.push(`${config.label}: ${config.values[company.needDetails[key]] || company.needDetails[key]}`);
                        }
                    }
                    
                    if (modalitesDetails.length > 0) {
                        modalitesHtml += modalitesDetails.join(', ');
                    } else {
                        modalitesHtml += 'Non spécifiées';
                    }
                    
                    modalitesHtml += '</p>';
                    needsHtml += modalitesHtml;
                }
                
                document.getElementById('needs-display').innerHTML = needsHtml;
                document.getElementById('editNeeds').value = company.needs || '';
                
                // Charger les modalités dans le formulaire d'édition des besoins
                if (company.needDetails) {
                    if (company.needDetails.frequency) 
                        document.getElementById('editNeedFrequency').value = company.needDetails.frequency;
                    if (company.needDetails.mode) 
                        document.getElementById('editNeedMode').value = company.needDetails.mode;
                    if (company.needDetails.expertise) 
                        document.getElementById('editNeedExpertise').value = company.needDetails.expertise;
                }
                
                // Mettre à jour l'affichage des catégories de besoins
                if (company.needCategories) {
                    updateCategoriesDisplay('need', company.needCategories);
                }
                
                // Charger les préférences
                const prefText = {
                    'all': 'Toutes les correspondances',
                    'weekly': 'Résumé hebdomadaire',
                    'important': 'Correspondances importantes uniquement',
                    'none': 'Aucune notification'
                };
                document.getElementById('preferences-display').innerHTML = `
                    <p>${prefText[company.notifications] || 'Toutes les correspondances'}</p>
                `;
                document.getElementById('editPreferences').value = company.notifications || 'all';
            }
        }
        
        // Fonction pour basculer l'affichage/édition d'une section
        function toggleEdit(section) {
            const displayElement = document.getElementById(section + '-display');
            const editElement = document.getElementById(section + '-edit');
            
            if (displayElement && editElement) {
                if (displayElement.classList.contains('hidden')) {
                    displayElement.classList.remove('hidden');
                    editElement.classList.add('hidden');
                } else {
                    displayElement.classList.add('hidden');
                    editElement.classList.remove('hidden');
                }
            }
        }
        
        // Fonction pour enregistrer les modifications d'une section
        function saveSection(section) {
            const email = localStorage.getItem('currentLoggedIn');
            if (!email) return;
            
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const companyIndex = companies.findIndex(c => c.email === email);
            
            if (companyIndex !== -1) {
                const company = companies[companyIndex];
                
                // Mettre à jour selon la section
                if (section === 'company-info') {
                    company.name = document.getElementById('editName').value;
                    company.address = document.getElementById('editAddress').value;
                    company.zipCode = document.getElementById('editZip').value;
                    company.city = document.getElementById('editCity').value;
                    company.website = document.getElementById('editWebsite').value;
                } else if (section === 'resources') {
                    company.resources = document.getElementById('editResources').value;
                    
                    // Sauvegarder les modalités
                    if (!company.resourceDetails) company.resourceDetails = {};
                    company.resourceDetails.frequency = document.getElementById('editResourceFrequency').value;
                    company.resourceDetails.mode = document.getElementById('editResourceMode').value;
                    company.resourceDetails.expertise = document.getElementById('editResourceExpertise').value;
                    
                } else if (section === 'needs') {
                    company.needs = document.getElementById('editNeeds').value;
                    
                    // Sauvegarder les modalités
                    if (!company.needDetails) company.needDetails = {};
                    company.needDetails.frequency = document.getElementById('editNeedFrequency').value;
                    company.needDetails.mode = document.getElementById('editNeedMode').value;
                    company.needDetails.expertise = document.getElementById('editNeedExpertise').value;
                    
                } else if (section === 'preferences') {
                    company.notifications = document.getElementById('editPreferences').value;
                }
                
                // Enregistrer les modifications
                companies[companyIndex] = company;
                localStorage.setItem('companies', JSON.stringify(companies));
                
                // Recharger les données pour afficher les modifications
                loadProfileData();
                
                // Basculer vers l'affichage
                toggleEdit(section);
                
                // Message de confirmation
                alert('Vos modifications ont été enregistrées avec succès.');
            }
        }
        
        // Fonction pour exporter les données de l'entreprise
        function exportData() {
            const email = localStorage.getItem('currentLoggedIn');
            if (!email) return;
            
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const company = companies.find(c => c.email === email);
            
            if (company) {
                // Formater les données pour l'export
                const prefText = {
                    'all': 'Toutes les correspondances',
                    'weekly': 'Résumé hebdomadaire',
                    'important': 'Correspondances importantes uniquement',
                    'none': 'Aucune notification'
                };
                
                const now = new Date();
                const date = `${now.getDate().toString().padStart(2, '0')}/${(now.getMonth()+1).toString().padStart(2, '0')}/${now.getFullYear()}`;
                
                let exportText = `PROFIL ENTREPRISE SUR RÉ(GE)NÈRE
Date d'exportation : ${date}

INFORMATIONS DE L'ENTREPRISE
--------------------------
Nom : ${company.name || ''}
Adresse : ${company.address || ''}
Code postal : ${company.zipCode || ''}
Ville : ${company.city || ''}
Site web : ${company.website || ''}
Email : ${company.email || ''}

RESSOURCES DISPONIBLES
--------------------------`;

                if (company.resourceCategories && company.resourceCategories.length > 0) {
                    exportText += `\nCatégories : ${company.resourceCategories.join(', ')}`;
                }
                
                exportText += `\nDescription : ${company.resources || 'Aucune ressource spécifiée'}`;
                
                // Ajouter les modalités d'échange pour les ressources
                if (company.resourceDetails) {
                    const modalitesMap = {
                        frequency: { 
                            label: 'Fréquence', 
                            values: { ponctuel: 'Ponctuel', regulier: 'Régulier', demande: 'Sur demande' } 
                        },
                        mode: { 
                            label: 'Mode d\'échange', 
                            values: { presentiel: 'En présentiel', distance: 'À distance', mixte: 'Mixte' } 
                        },
                        expertise: { 
                            label: 'Niveau d\'expertise', 
                            values: { initiation: 'Initiation', intermediaire: 'Intermédiaire', expert: 'Expert' } 
                        }
                    };
                    
                    let hasModalites = false;
                    exportText += '\nModalités d\'échange :';
                    
                    for (const [key, config] of Object.entries(modalitesMap)) {
                        if (company.resourceDetails[key]) {
                            hasModalites = true;
                            exportText += `\n- ${config.label}: ${config.values[company.resourceDetails[key]] || company.resourceDetails[key]}`;
                        }
                    }
                    
                    if (!hasModalites) {
                        exportText += ' Non spécifiées';
                    }
                }

                exportText += `\n\nBESOINS RECHERCHÉS
--------------------------`;

                if (company.needCategories && company.needCategories.length > 0) {
                    exportText += `\nCatégories : ${company.needCategories.join(', ')}`;
                }
                
                exportText += `\nDescription : ${company.needs || 'Aucun besoin spécifié'}`;
                
                // Ajouter les modalités d'échange pour les besoins
                if (company.needDetails) {
                    const modalitesMap = {
                        frequency: { 
                            label: 'Fréquence', 
                            values: { ponctuel: 'Ponctuel', regulier: 'Régulier', demande: 'Sur demande' } 
                        },
                        mode: { 
                            label: 'Mode d\'échange', 
                            values: { presentiel: 'En présentiel', distance: 'À distance', mixte: 'Mixte' } 
                        },
                        expertise: { 
                            label: 'Niveau d\'expertise', 
                            values: { initiation: 'Initiation', intermediaire: 'Intermédiaire', expert: 'Expert' } 
                        }
                    };
                    
                    let hasModalites = false;
                    exportText += '\nModalités d\'échange :';
                    
                    for (const [key, config] of Object.entries(modalitesMap)) {
                        if (company.needDetails[key]) {
                            hasModalites = true;
                            exportText += `\n- ${config.label}: ${config.values[company.needDetails[key]] || company.needDetails[key]}`;
                        }
                    }
                    
                    if (!hasModalites) {
                        exportText += ' Non spécifiées';
                    }
                }

                exportText += `\n\nPRÉFÉRENCES DE NOTIFICATION
--------------------------
${prefText[company.notifications] || 'Toutes les correspondances'}

---
Pour mettre à jour ces informations, reconnectez-vous sur Ré(GE)nère avec votre email.
Ces données sont stockées localement sur votre appareil. Conservez ce fichier pour les retrouver en cas de changement d'appareil.`;
                
                // Créer et télécharger le fichier
                const blob = new Blob([exportText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `regenere-profil-${company.name.replace(/\s+/g, '-').toLowerCase()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('Vos données ont été exportées avec succès. Veuillez conserver ce fichier dans un emplacement sécurisé.');
            }
        }
        
        // Fonction pour enregistrer une nouvelle entreprise
        function registerCompany() {
            const name = document.getElementById('companyName').value;
            const address = document.getElementById('address').value;
            const zipCode = document.getElementById('zipCode').value;
            const city = document.getElementById('city').value;
            const website = document.getElementById('website').value;
            const email = document.getElementById('email').value;
            const resources = document.getElementById('resources').value;
            const needs = document.getElementById('needs').value;
            const notifications = document.getElementById('notifications').value;
            
            // Nouvelles informations de modalités
            const resourceFrequency = document.getElementById('resourceFrequency').value;
            const resourceMode = document.getElementById('resourceMode').value;
            const resourceExpertise = document.getElementById('resourceExpertise').value;
            const needFrequency = document.getElementById('needFrequency').value;
            const needMode = document.getElementById('needMode').value;
            const needExpertise = document.getElementById('needExpertise').value;
            
            // Validation simple
            if (!name || !address || !zipCode || !city || !email || !resources || !needs) {
                alert('Veuillez remplir tous les champs obligatoires.');
                return;
            }
            
            // Vérifier que des catégories ont été sélectionnées
            if (registerResourceCategories.length === 0 || registerNeedCategories.length === 0) {
                alert('Veuillez sélectionner au moins une catégorie pour les ressources et les besoins.');
                return;
            }
            
            // Vérifier si l'email existe déjà
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            if (companies.some(c => c.email === email)) {
                alert('Une entreprise est déjà inscrite avec cet email. Veuillez utiliser la fonction "Accéder à mon profil" pour modifier vos informations.');
                return;
            }
            
            // Créer l'objet entreprise avec les nouvelles informations
            const company = {
                name,
                address,
                zipCode,
                city,
                website,
                email,
                resources,
                needs,
                notifications,
                resourceCategories: [...registerResourceCategories],
                needCategories: [...registerNeedCategories],
                resourceDetails: {
                    frequency: resourceFrequency,
                    mode: resourceMode,
                    expertise: resourceExpertise
                },
                needDetails: {
                    frequency: needFrequency,
                    mode: needMode,
                    expertise: needExpertise
                }
            };
            
            // Ajouter à la liste et sauvegarder
            companies.push(company);
            localStorage.setItem('companies', JSON.stringify(companies));
            
            // Réinitialiser le formulaire et les catégories
            document.getElementById('registrationForm').reset();
            registerResourceCategories = [];
            registerNeedCategories = [];
            document.getElementById('register-resources-categories').innerHTML = '';
            document.getElementById('register-needs-categories').innerHTML = '';
            
            // Message de confirmation
            alert('Votre entreprise a été inscrite avec succès ! Vous pouvez maintenant accéder à votre profil depuis le bouton "Accéder à mon profil".');
        }
        
        // Initialiser les dropdowns au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            populateCategoryDropdowns();
            
            // Mettre à jour les placeholders pour des exemples plus parlants
            const resourcesPlaceholder = document.getElementById('resources');
            if (resourcesPlaceholder) {
                resourcesPlaceholder.placeholder = "Exemples : 2h de conseil en stratégie durable par mois, atelier de méditation hebdomadaire, 15kg de carton recyclé chaque semaine, salle de réunion disponible les vendredis...";
            }
            
            const needsPlaceholder = document.getElementById('needs');
            if (needsPlaceholder) {
                needsPlaceholder.placeholder = "Exemples : Recherche expertise en marketing digital (2h/mois), besoin de palettes en bois, espace de stockage temporaire, formation en comptabilité...";
            }
            
            const editResourcesPlaceholder = document.getElementById('editResources');
            if (editResourcesPlaceholder) {
                editResourcesPlaceholder.placeholder = "Décrivez en détail les ressources que vous offrez, incluant fréquence, modalités et conditions...";
            }
            
            const editNeedsPlaceholder = document.getElementById('editNeeds');
            if (editNeedsPlaceholder) {
                editNeedsPlaceholder.placeholder = "Décrivez en détail les ressources dont vous avez besoin, incluant fréquence, modalités et conditions...";
            }
        });
    <script>
// Fonction pour trouver les correspondances pour une entreprise
function findMatchesForCompany(companyEmail) {
    const companies = JSON.parse(localStorage.getItem('companies') || '[]');
    const currentCompany = companies.find(c => c.email === companyEmail);
    
    if (!currentCompany) return [];
    
    let matches = [];
    
    // Parcourir toutes les autres entreprises
    companies.forEach(company => {
        if (company.email === companyEmail) return; // Ignorer l'entreprise actuelle
        
        let hasMatch = false;
        let matchDetails = {
            theyProvide: [],  // Ce qu'ils peuvent nous fournir
            weProvide: []     // Ce que nous pouvons leur fournir
        };
        
        // Vérifier si les besoins de l'entreprise actuelle correspondent aux ressources de l'autre entreprise
        if (currentCompany.needCategories && company.resourceCategories) {
            const commonCategories = currentCompany.needCategories.filter(cat => 
                company.resourceCategories.includes(cat)
            );
            
            if (commonCategories.length > 0) {
                hasMatch = true;
                matchDetails.theyProvide = commonCategories;
            }
        }
        
        // Vérifier si les ressources de l'entreprise actuelle correspondent aux besoins de l'autre entreprise
        if (currentCompany.resourceCategories && company.needCategories) {
            const commonCategories = currentCompany.resourceCategories.filter(cat => 
                company.needCategories.includes(cat)
            );
            
            if (commonCategories.length > 0) {
                hasMatch = true;
                matchDetails.weProvide = commonCategories;
            }
        }
        
        // Si on a trouvé des correspondances, ajouter à la liste
        if (hasMatch) {
            matches.push({
                company: company,
                details: matchDetails
            });
        }
    });
    
    return matches;
}

// Fonction pour créer une carte de match
function createMatchCard(match, isNew) {
    const matchCard = document.createElement('div');
    matchCard.className = 'profile-section';
    matchCard.style.marginBottom = '15px';
    matchCard.style.padding = '15px';
    matchCard.style.backgroundColor = isNew ? '#FDF5E8' : '#f7f7f7';
    matchCard.style.borderLeft = isNew ? '4px solid #E76F51' : '4px solid #2A9D8F';
    
    // En-tête avec nom de l'entreprise et badge "Nouveau" si applicable
    const headerDiv = document.createElement('div');
    headerDiv.style.display = 'flex';
    headerDiv.style.justifyContent = 'space-between';
    headerDiv.style.alignItems = 'center';
    headerDiv.style.marginBottom = '10px';
    
    const companyName = document.createElement('h4');
    companyName.textContent = match.company.name;
    companyName.style.margin = '0';
    companyName.style.color = '#264653';
    
    headerDiv.appendChild(companyName);
    
    // Ajouter un badge "Nouveau" si c'est un nouveau match
    if (isNew) {
        const newBadge = document.createElement('span');
        newBadge.textContent = 'NOUVEAU';
        newBadge.style.backgroundColor = '#E76F51';
        newBadge.style.color = 'white';
        newBadge.style.padding = '4px 8px';
        newBadge.style.borderRadius = '4px';
        newBadge.style.fontSize = '0.8rem';
        headerDiv.appendChild(newBadge);
    }
    
    matchCard.appendChild(headerDiv);
    
    // Afficher ce que l'autre entreprise peut nous fournir
    if (match.details.theyProvide && match.details.theyProvide.length > 0) {
        const theyProvideTitle = document.createElement('p');
        theyProvideTitle.innerHTML = `<strong>${match.company.name} peut vous fournir :</strong>`;
        theyProvideTitle.style.marginBottom = '5px';
        
        const categoriesDiv = document.createElement('div');
        categoriesDiv.className = 'tag-container';
        categoriesDiv.style.marginBottom = '10px';
        
        match.details.theyProvide.forEach(category => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = category;
            tag.style.backgroundColor = '#E9C46A';
            categoriesDiv.appendChild(tag);
        });
        
        matchCard.appendChild(theyProvideTitle);
        matchCard.appendChild(categoriesDiv);
    }
    
    // Afficher ce que nous pouvons fournir à l'autre entreprise
    if (match.details.weProvide && match.details.weProvide.length > 0) {
        const weProvideTitle = document.createElement('p');
        weProvideTitle.innerHTML = `<strong>Vous pouvez fournir à ${match.company.name} :</strong>`;
        weProvideTitle.style.marginBottom = '5px';
        
        const categoriesDiv = document.createElement('div');
        categoriesDiv.className = 'tag-container';
        categoriesDiv.style.marginBottom = '10px';
        
        match.details.weProvide.forEach(category => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = category;
            tag.style.backgroundColor = '#2A9D8F';
            tag.style.color = 'white';
            categoriesDiv.appendChild(tag);
        });
        
        matchCard.appendChild(weProvideTitle);
        matchCard.appendChild(categoriesDiv);
    }
    
    // Bouton de contact (uniquement pour les nouveaux matchs)
    if (isNew) {
        const contactBtn = document.createElement('button');
        contactBtn.className = 'add-category-btn';
        contactBtn.textContent = `Contacter ${match.company.name}`;
        contactBtn.style.marginTop = '10px';
        contactBtn.onclick = function() {
            window.location.href = `mailto:${match.company.email}?subject=Potentielle synergie via Ré(GE)nère&body=Bonjour,%0A%0AJe vous contacte suite à une correspondance identifiée sur la plateforme Ré(GE)nère.%0A%0ACordiales salutations`;
        };
        
        matchCard.appendChild(contactBtn);
    }
    
    return matchCard;
}

// Fonction pour afficher les correspondances dans le profil
function displayMatches() {
    const email = localStorage.getItem('currentLoggedIn');
    if (!email) return;
    
    // Trouver les correspondances actuelles
    const currentMatches = findMatchesForCompany(email);
    
    // Vérifier si la section de correspondances existe déjà
    let matchesSection = document.getElementById('matches-section');
    
    // Si elle n'existe pas, la créer et l'insérer avant la notice de données
    if (!matchesSection) {
        // Créer une section pour les correspondances
        matchesSection = document.createElement('div');
        matchesSection.id = 'matches-section';
        matchesSection.className = 'profile-section';
        
        const sectionTitle = document.createElement('h3');
        sectionTitle.textContent = '🔄 Correspondances détectées';
        
        matchesSection.appendChild(sectionTitle);
        
        // Créer un conteneur pour les nouveaux matchs
        const newMatchesTitle = document.createElement('h4');
        newMatchesTitle.textContent = '🌟 Nouveaux matchs';
        newMatchesTitle.style.color = '#E76F51';
        newMatchesTitle.style.marginTop = '20px';
        
        const newMatchesContainer = document.createElement('div');
        newMatchesContainer.id = 'new-matches-container';
        
        matchesSection.appendChild(newMatchesTitle);
        matchesSection.appendChild(newMatchesContainer);
        
        // Ajouter à la page
        const profileContent = document.getElementById('profileContent');
        const exportBtn = profileContent.querySelector('.export-btn');
        
        if (exportBtn) {
            profileContent.insertBefore(matchesSection, exportBtn);
        } else {
            profileContent.appendChild(matchesSection);
        }
    }
    
    // Afficher les nouveaux matchs
    const newMatchesContainer = document.getElementById('new-matches-container');
    newMatchesContainer.innerHTML = '';
    
    if (currentMatches.length === 0) {
        const noMatchesMsg = document.createElement('p');
        noMatchesMsg.textContent = 'Aucune nouvelle correspondance trouvée pour le moment.';
        newMatchesContainer.appendChild(noMatchesMsg);
    } else {
        // Afficher les matchs actuels (limités à 3)
        const matchesToShow = currentMatches.slice(0, 3);
        matchesToShow.forEach(match => {
            const matchCard = createMatchCard(match, true);
            newMatchesContainer.appendChild(matchCard);
        });
        
        // Si plus de 3 correspondances, indiquer "et plus..."
        if (currentMatches.length > 3) {
            const moreMatches = document.createElement('p');
            moreMatches.style.textAlign = 'center';
            moreMatches.style.fontStyle = 'italic';
            moreMatches.textContent = `+ ${currentMatches.length - 3} autre(s) correspondance(s)`;
            newMatchesContainer.appendChild(moreMatches);
        }
    }
}

// Créer une bannière de notifications sur la page d'accueil pour montrer les nouveaux matchs
function createMatchesBanner() {
    const email = localStorage.getItem('currentLoggedIn');
    if (!email) return;
    
    // Vérifier si la bannière existe déjà
    if (document.getElementById('matches-banner')) return;
    
    // Trouver l'élément où insérer la bannière
    const introSection = document.getElementById('intro');
    if (!introSection) return;
    
    // Récupérer les correspondances actuelles
    const currentMatches = findMatchesForCompany(email);
    
    if (currentMatches.length === 0) return; // Ne rien afficher s'il n'y a pas de correspondances
    
    // Créer la bannière
    const banner = document.createElement('div');
    banner.id = 'matches-banner';
    banner.style.backgroundColor = '#FDF5E8';
    banner.style.border = '3px solid #E76F51';
    banner.style.borderRadius = '8px';
    banner.style.padding = '15px 20px';
    banner.style.margin = '0 auto 30px auto';
    banner.style.maxWidth = '1000px';
    
    const headerDiv = document.createElement('div');
    headerDiv.style.display = 'flex';
    headerDiv.style.justifyContent = 'space-between';
    headerDiv.style.alignItems = 'center';
    headerDiv.style.marginBottom = '15px';
    
    const title = document.createElement('h3');
    title.textContent = '🔄 Nouvelles correspondances détectées !';
    title.style.margin = '0';
    title.style.color = '#E76F51';
    
    const viewAllBtn = document.createElement('button');
    viewAllBtn.className = 'add-category-btn';
    viewAllBtn.textContent = 'Voir toutes';
    viewAllBtn.onclick = function() {
        openModal('profileModal');
        loadProfileData();
    };
    
    headerDiv.appendChild(title);
    headerDiv.appendChild(viewAllBtn);
    banner.appendChild(headerDiv);
    
    // Afficher les 3 premières correspondances uniquement
    const matchesToShow = currentMatches.slice(0, 3);
    
    matchesToShow.forEach((match, idx) => {
        const matchDiv = document.createElement('div');
        matchDiv.style.padding = '10px';
        matchDiv.style.backgroundColor = idx % 2 === 0 ? '#fff' : '#f8f8f8';
        matchDiv.style.borderRadius = '4px';
        matchDiv.style.marginBottom = '10px';
        
        const matchText = document.createElement('p');
        matchText.style.margin = '0';
        
        let matchDescription = `<strong>${match.company.name}</strong> : `;
        
        let categories = [];
        if (match.details.theyProvide.length > 0) {
            categories.push(`Ils peuvent vous fournir <span style="color:#E76F51">${match.details.theyProvide.join(', ')}</span>`);
        }
        
        if (match.details.weProvide.length > 0) {
            categories.push(`Vous pouvez leur fournir <span style="color:#2A9D8F">${match.details.weProvide.join(', ')}</span>`);
        }
        
        matchText.innerHTML = matchDescription + categories.join(' et ');
        matchDiv.appendChild(matchText);
        banner.appendChild(matchDiv);
    });
    
    // Si plus de 3 correspondances, indiquer "et plus..."
    if (currentMatches.length > 3) {
        const moreText = document.createElement('p');
        moreText.textContent = `Et ${currentMatches.length - 3} autre(s) correspondance(s)...`;
        moreText.style.textAlign = 'center';
        moreText.style.fontStyle = 'italic';
        moreText.style.margin = '5px 0 0 0';
        banner.appendChild(moreText);
    }
    
    // Insérer après la section d'intro
    introSection.parentNode.insertBefore(banner, introSection.nextSibling);
}

// Modifier les fonctions existantes pour intégrer les correspondances
const originalLoadProfileData = loadProfileData;
loadProfileData = function() {
    originalLoadProfileData();
    displayMatches();
};

// Exécuter au chargement de la page
const originalDOMContentLoadedHandler = document.addEventListener('DOMContentLoaded', function() {
    // Nouveau code pour les correspondances
    const email = localStorage.getItem('currentLoggedIn');
    if (email) {
        // Si un utilisateur est connecté, afficher la bannière de matchs sur la page d'accueil
        createMatchesBanner();
    }
});
</script>
<script>
// Fonction de débogage à exécuter après que la page soit chargée
function debugMatches() {
    const email = localStorage.getItem('currentLoggedIn');
    
    if (!email) {
        console.log("Aucun utilisateur connecté");
        alert("Aucun utilisateur connecté. Veuillez vous connecter pour voir les correspondances.");
        return;
    }
    
    console.log("Utilisateur connecté:", email);
    
    const companies = JSON.parse(localStorage.getItem('companies') || '[]');
    console.log("Entreprises enregistrées:", companies);
    
    const currentCompany = companies.find(c => c.email === email);
    console.log("Entreprise actuelle:", currentCompany);
    
    if (!currentCompany) {
        console.log("Entreprise actuelle non trouvée");
        alert("Entreprise actuelle non trouvée dans les données.");
        return;
    }
    
    console.log("Ressources de l'entreprise:", currentCompany.resourceCategories);
    console.log("Besoins de l'entreprise:", currentCompany.needCategories);
    
    const matches = findMatchesForCompany(email);
    console.log("Correspondances trouvées:", matches);
    
    if (matches.length === 0) {
        console.log("Aucune correspondance trouvée");
        alert("Aucune correspondance trouvée pour votre entreprise. Vérifiez que d'autres entreprises ont des besoins/ressources qui correspondent aux vôtres.");
    } else {
        console.log("Nombre de correspondances:", matches.length);
        alert(`${matches.length} correspondance(s) trouvée(s) pour votre entreprise. Vérifiez la console pour plus de détails.`);
    }
}

// Ajouter un bouton pour exécuter la fonction de débogage
document.addEventListener('DOMContentLoaded', function() {
    const debugButton = document.createElement('button');
    debugButton.textContent = "Déboguer les correspondances";
    debugButton.style.position = "fixed";
    debugButton.style.bottom = "10px";
    debugButton.style.right = "10px";
    debugButton.style.zIndex = "1000";
    debugButton.style.padding = "10px";
    debugButton.style.backgroundColor = "#264653";
    debugButton.style.color = "white";
    debugButton.style.border = "none";
    debugButton.style.borderRadius = "5px";
    debugButton.style.cursor = "pointer";
    debugButton.onclick = debugMatches;
    
    document.body.appendChild(debugButton);
});

// Fonction pour trouver les correspondances pour une entreprise
function findMatchesForCompany(companyEmail) {
    const companies = JSON.parse(localStorage.getItem('companies') || '[]');
    const currentCompany = companies.find(c => c.email === companyEmail);
    
    if (!currentCompany) return [];
    
    let matches = [];
    
    // Parcourir toutes les autres entreprises
    companies.forEach(company => {
        if (company.email === companyEmail) return; // Ignorer l'entreprise actuelle
        
        let hasMatch = false;
        let matchDetails = {
            theyProvide: [],  // Ce qu'ils peuvent nous fournir
            weProvide: []     // Ce que nous pouvons leur fournir
        };
        
        // Vérifier si les besoins de l'entreprise actuelle correspondent aux ressources de l'autre entreprise
        if (currentCompany.needCategories && company.resourceCategories) {
            const commonCategories = currentCompany.needCategories.filter(cat => 
                company.resourceCategories.includes(cat)
            );
            
            if (commonCategories.length > 0) {
                hasMatch = true;
                matchDetails.theyProvide = commonCategories;
            }
        }
        
        // Vérifier si les ressources de l'entreprise actuelle correspondent aux besoins de l'autre entreprise
        if (currentCompany.resourceCategories && company.needCategories) {
            const commonCategories = currentCompany.resourceCategories.filter(cat => 
                company.needCategories.includes(cat)
            );
            
            if (commonCategories.length > 0) {
                hasMatch = true;
                matchDetails.weProvide = commonCategories;
            }
        }
        
        // Si on a trouvé des correspondances, ajouter à la liste
        if (hasMatch) {
            matches.push({
                company: company,
                details: matchDetails
            });
        }
    });
    
    return matches;
}
</script>
<script>
// Code simple pour vérifier EmailJS
document.addEventListener('DOMContentLoaded', function() {
    // Créer un bouton de test EmailJS
    const testButton = document.createElement('button');
    testButton.textContent = "Tester EmailJS";
    testButton.style.position = "fixed";
    testButton.style.bottom = "10px";
    testButton.style.right = "10px";
    testButton.style.zIndex = "1000";
    testButton.style.padding = "10px";
    testButton.style.backgroundColor = "#E76F51";
    testButton.style.color = "white";
    testButton.style.border = "none";
    testButton.style.borderRadius = "5px";
    testButton.style.cursor = "pointer";
    
    testButton.onclick = function() {
        // Vérifier si EmailJS est chargé
        if (typeof emailjs === 'undefined') {
            alert("EmailJS n'est pas chargé sur cette page!");
            console.error("EmailJS n'est pas chargé");
            return;
        }
        
        // Demander les informations nécessaires
        const email = prompt("Entrez votre adresse email pour le test :");
        if (!email) return;
        
        const serviceID = prompt("Entrez l'ID de service EmailJS :");
        if (!serviceID) return;
        
        // Utiliser le template ID existant ou en demander un nouveau
        const templateID = prompt("Entrez l'ID du template (par défaut: template_zm00bwr) :", "template_zm00bwr");
        if (!templateID) return;
        
        // Préparer les paramètres pour le template
        const templateParams = {
            to_email: email,
            from_name: "Test Ré(GE)nère",
            to_name: "Utilisateur test",
            message: "Ceci est un email de test depuis la plateforme Ré(GE)nère."
            // Ajoutez d'autres paramètres selon les besoins de votre template
        };
        
        // Afficher les informations avant l'envoi
        console.log("Tentative d'envoi d'email avec :");
        console.log("- Service ID :", serviceID);
        console.log("- Template ID :", templateID);
        console.log("- Paramètres :", templateParams);
        
        // Envoyer l'email
        alert("Tentative d'envoi d'email à " + email + "...");
        
        emailjs.send(serviceID, templateID, templateParams)
            .then(function(response) {
                console.log("✅ Email envoyé avec succès :", response);
                alert("✅ Email envoyé avec succès ! Statut : " + response.status);
            })
            .catch(function(error) {
                console.error("❌ Erreur lors de l'envoi de l'email :", error);
                alert("❌ Erreur lors de l'envoi de l'email : " + error.text);
            });
    };
    
    // Ajouter le bouton à la page
    document.body.appendChild(testButton);
});
</script>
<script>
// Version améliorée qui attend que EmailJS soit complètement chargé
(function() {
    // Fonction qui vérifie si EmailJS est chargé et configure l'interception
    function configureEmailJS() {
        if (typeof emailjs === 'undefined') {
            console.log("EmailJS n'est pas encore chargé, nouvelle tentative dans 1 seconde...");
            setTimeout(configureEmailJS, 1000);
            return;
        }

        console.log("EmailJS est chargé, configuration de l'interception...");
        
        // Stocker la version originale de emailjs.send
        const originalEmailJSSend = emailjs.send;
        
        // Remplacer emailjs.send par notre version améliorée
        emailjs.send = function(serviceID, templateID, params) {
            console.log("Appel à emailjs.send intercepté", {serviceID, templateID, params});
            
            // Si les paramètres sont manquants, créer un objet avec les paramètres nécessaires
            if (!params) {
                console.warn("EmailJS : Paramètres manquants, ajout de paramètres par défaut");
                
                // Demander l'email du destinataire si nécessaire
                let recipientEmail = prompt("Entrez l'adresse email du destinataire :");
                if (!recipientEmail) {
                    alert("Envoi annulé : adresse email nécessaire.");
                    return Promise.reject(new Error("Adresse email manquante"));
                }
                
                // Créer un objet avec tous les paramètres possibles
                params = {
                    to_email: recipientEmail,
                    email: recipientEmail,
                    recipient: recipientEmail,
                    to: recipientEmail,
                    user_email: recipientEmail,
                    
                    from_name: "Ré(GE)nère Plateforme",
                    to_name: "Utilisateur",
                    subject: "Notification de Ré(GE)nère",
                    message: "Notification automatique de la plateforme Ré(GE)nère."
                };
                
                console.log("EmailJS : Utilisation des paramètres par défaut :", params);
            }
            
            // Appeler la méthode originale avec les paramètres
            console.log("Envoi de l'email avec paramètres:", params);
            return originalEmailJSSend.call(emailjs, serviceID, templateID, params)
                .then(function(response) {
                    console.log("✅ Email envoyé avec succès :", response);
                    alert("✅ Email envoyé avec succès !");
                    return response;
                })
                .catch(function(error) {
                    console.error("❌ Erreur lors de l'envoi de l'email :", error);
                    alert("❌ Erreur : " + (error.text || error.message || "Inconnue"));
                    throw error;
                });
        };
        
        console.log("EmailJS : Configuration améliorée activée");
    }

    // Démarrer la vérification une fois que la page est chargée
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', configureEmailJS);
    } else {
        configureEmailJS();
    }
    
    // Ajouter le bouton de test
    function addTestButton() {
        // Vérifier si le bouton existe déjà
        if (document.getElementById('new-emailjs-test-button')) {
            return;
        }
        
        const newTestButton = document.createElement('button');
        newTestButton.id = 'new-emailjs-test-button';
        newTestButton.textContent = "Nouveau Test EmailJS";
        newTestButton.style.position = "fixed";
        newTestButton.style.bottom = "50px";
        newTestButton.style.right = "150px";
        newTestButton.style.zIndex = "1000";
        newTestButton.style.padding = "10px";
        newTestButton.style.backgroundColor = "#2A9D8F";
        newTestButton.style.color = "white";
        newTestButton.style.border = "none";
        newTestButton.style.borderRadius = "5px";
        newTestButton.style.cursor = "pointer";
        
        newTestButton.onclick = function() {
            console.log("Bouton de test cliqué");
            if (typeof emailjs === 'undefined') {
                alert("EmailJS n'est pas encore chargé!");
                return;
            }
            
            try {
                alert("Tentative d'envoi d'email...");
                emailjs.send("service_w5kg7es", "template_zm00bwr");
            } catch (error) {
                console.error("Erreur lors de l'appel à emailjs.send:", error);
                alert("Erreur: " + (error.message || "Inconnue"));
            }
        };
        
        document.body.appendChild(newTestButton);
        console.log("Bouton de test ajouté");
    }

    // Ajouter le bouton de test une fois que la page est chargée
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', addTestButton);
    } else {
        addTestButton();
    }
})();
</script>
</body>
</html>
