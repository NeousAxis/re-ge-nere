<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Balises anti-cache renforcées -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Paramètre timestamp unique pour forcer le rechargement -->
    <link rel="stylesheet" href="style.css?v=<?php echo time(); ?>">
    <title>Ré(GE)nère - Plateforme d'Écosystème Mutualisé</title>
    <style>
        :root {
            --primary-color: #3a7e6d;
            --secondary-color: #a1d4c6;
            --accent-color: #f0a849;
            --warning-color: #e74c3c;
            --dark-text: #333333;
            --light-text: #ffffff;
            --background-light: #f5f5f5;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-light);
            color: var(--dark-text);
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .selection-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .category-group {
            margin-bottom: 20px;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background-color: white;
            margin-bottom: 10px;
        }
        
        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .tag {
            background-color: var(--secondary-color);
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tag-remove {
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .output-area {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #2d6354;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: #e0e0e0;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .notification-settings {
            background-color: #f5f8ff;
            border: 1px solid #dde5ff;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            margin: 0;
        }
        
        .progress-indicator {
            display: flex;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        
        .progress-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
        }
        
        .progress-step::after {
            content: '';
            position: absolute;
            height: 2px;
            background-color: #ddd;
            top: 50%;
            left: 50%;
            width: 100%;
            z-index: -1;
        }
        
        .progress-step:last-child::after {
            display: none;
        }
        
        .progress-step.active {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .progress-step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #ddd;
            border-radius: 50%;
            line-height: 30px;
            margin-bottom: 8px;
        }
        
        .progress-step.active .progress-step-number {
            background-color: var(--primary-color);
            color: white;
        }
        
        .logo {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .logo span {
            color: var(--accent-color);
        }
        
        .cache-alert {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .cache-alert.critical {
            background-color: #ffe6e6;
            border-color: var(--warning-color);
        }
        
        .cache-alert h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .cache-alert.critical h3 {
            color: var(--warning-color);
        }
        
        .cache-steps {
            margin-top: 10px;
        }
        
        .cache-steps li {
            margin-bottom: 10px;
        }
        
        .cache-toggle {
            color: #0066cc;
            text-decoration: underline;
            cursor: pointer;
            font-weight: bold;
        }
        
        .cache-refresh-btn {
            background-color: #ffc107;
            color: #333;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
        }
        
        .cache-refresh-btn.critical {
            background-color: var(--warning-color);
            color: white;
        }
        
        .cache-refresh-btn:hover {
            opacity: 0.9;
        }
        
        .close-alert {
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            font-size: 20px;
            color: #856404;
        }
        
        .close-alert:hover {
            color: #533f03;
        }
        
        .cache-status {
            padding: 8px 12px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .cache-status.ok {
            background-color: #d4edda;
            color: #155724;
        }
        
        .cache-status.problem {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .other-field {
            display: none;
            margin-top: 8px;
        }
        
        @media (max-width: 768px) {
            .container {
                gap: 20px;
            }
            
            .section {
                padding: 15px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="logo">Ré<span>(GE)</span>nère</div>
    <p style="text-align: center;">Plateforme d'Écosystème Mutualisé - Genève</p>
    
    <div class="cache-alert critical" id="cacheAlert">
        <span class="close-alert" onclick="dismissCacheAlert()">&times;</span>
        <h3>⚠️ Problème d'affichage détecté</h3>
        <p>Notre système a détecté que vous pourriez voir une version obsolète de cette page à cause d'un problème de cache.</p>
        <div id="cacheStatus" class="cache-status problem">Dernière mise à jour: aujourd'hui à 14:25</div>
        
        <div class="cache-steps">
            <h4>Solution immédiate :</h4>
            <button class="cache-refresh-btn critical" onclick="forceCacheRefresh()">Actualiser et vider le cache</button>
            
            <div class="cache-toggle" onclick="toggleCacheInstructions()">Afficher d'autres méthodes pour résoudre le problème</div>
            <div id="cache-instructions" style="display: none; margin-top: 15px;">
                <h4>Méthode 1 : Rechargement forcé</h4>
                <p>Utilisez le raccourci clavier :</p>
                <ul>
                    <li><strong>Windows/Linux :</strong> Ctrl + F5 ou Ctrl + Maj + R</li>
                    <li><strong>Mac :</strong> Cmd + Maj + R ou Cmd + Option + E (puis Cmd + R)</li>
                </ul>
                
                <h4>Méthode 2 : Vider le cache du navigateur</h4>
                <p><strong>Chrome :</strong></p>
                <ol>
                    <li>Ouvrez Chrome et appuyez sur Ctrl+Maj+Suppr (Windows) ou Cmd+Maj+Suppr (Mac)</li>
                    <li>Sélectionnez "Toutes les périodes" pour la plage de temps</li>
                    <li>Cochez "Images et fichiers en cache" et "Cookies et données de site"</li>
                    <li>Cliquez sur "Effacer les données"</li>
                </ol>
                
                <p><strong>Firefox :</strong></p>
                <ol>
                    <li>Ouvrez Firefox et appuyez sur Ctrl+Maj+Suppr (Windows) ou Cmd+Maj+Suppr (Mac)</li>
                    <li>Sélectionnez "Tout" pour la plage de temps</li>
                    <li>Cochez "Cache" et "Cookies"</li>
                    <li>Cliquez sur "Effacer maintenant"</li>
                </ol>
                
                <p><strong>Safari :</strong></p>
                <ol>
                    <li>Ouvrez Safari et cliquez sur "Safari" dans la barre de menu</li>
                    <li>Sélectionnez "Préférences" puis l'onglet "Avancées"</li>
                    <li>Cochez "Afficher le menu Développement"</li>
                    <li>Fermez et dans le menu "Développement", choisissez "Vider les caches"</li>
                </ol>
                
                <h4>Méthode 3 : Mode navigation privée</h4>
                <p>Ouvrez une fenêtre de navigation privée/incognito et accédez à nouveau à la page.</p>
            </div>
        </div>
    </div>
    
    <div class="progress-indicator">
        <div class="progress-step active">
            <div class="progress-step-number">1</div>
            <div>Informations</div>
        </div>
        <div class="progress-step">
            <div class="progress-step-number">2</div>
            <div>Ressources</div>
        </div>
        <div class="progress-step">
            <div class="progress-step-number">3</div>
            <div>Besoins</div>
        </div>
        <div class="progress-step">
            <div class="progress-step-number">4</div>
            <div>Notifications</div>
        </div>
    </div>
    
    <div class="container">
        <!-- SECTION 1: INFORMATIONS DE L'ENTREPRISE -->
        <div class="section tab-content active" id="tab-1">
            <div class="section-header">
                <h2 class="section-title">Informations de l'entreprise</h2>
            </div>
            
            <div class="form-group">
                <label for="entreprise-nom">Nom de l'entreprise *</label>
                <input type="text" id="entreprise-nom" required>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="entreprise-secteur">Secteur d'activité *</label>
                        <select id="entreprise-secteur" required onchange="toggleOtherField('entreprise-secteur', 'autre-secteur')">
                            <option value="">-- Sélectionnez un secteur --</option>
                            <option value="Agriculture">Agriculture, Sylviculture et Pêche</option>
                            <option value="Industrie">Industrie manufacturière</option>
                            <option value="Construction">Construction</option>
                            <option value="Commerce">Commerce</option>
                            <option value="Transport">Transport et Entreposage</option>
                            <option value="Restauration">Hébergement et Restauration</option>
                            <option value="Information">Information et Communication</option>
                            <option value="Finance">Activités financières et Assurance</option>
                            <option value="Immobilier">Activités immobilières</option>
                            <option value="Services">Services aux entreprises</option>
                            <option value="Santé">Santé humaine et Action sociale</option>
                            <option value="Arts">Arts, Spectacles et Activités récréatives</option>
                            <option value="Autre">Autre</option>
                        </select>
                        <div id="autre-secteur" class="other-field">
                            <label for="entreprise-secteur-autre">Précisez le secteur *</label>
                            <input type="text" id="entreprise-secteur-autre">
                        </div>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="entreprise-taille">Taille de l'entreprise *</label>
                        <select id="entreprise-taille" required>
                            <option value="">-- Sélectionnez une taille --</option>
                            <option value="TPE">1-9 employés (TPE)</option>
                            <option value="PME">10-249 employés (PME)</option>
                            <option value="ETI">250-4999 employés (ETI)</option>
                            <option value="GE">5000+ employés (Grande Entreprise)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="entreprise-description">Description de l'entreprise *</label>
                <textarea id="entreprise-description" required placeholder="Décrivez brièvement votre entreprise, ses activités et sa mission..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="entreprise-adresse">Adresse *</label>
                <input type="text" id="entreprise-adresse" required>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="entreprise-code-postal">Code postal *</label>
                        <input type="text" id="entreprise-code-postal" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="entreprise-ville">Ville *</label>
                        <input type="text" id="entreprise-ville" value="Genève" required>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="contact-nom">Nom du contact *</label>
                        <input type="text" id="contact-nom" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="contact-fonction">Fonction *</label>
                        <input type="text" id="contact-fonction" required>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="contact-email">Email *</label>
                <input type="email" id="contact-email" required>
            </div>
            
            <div class="form-group">
                <label for="entreprise-site">Site web</label>
                <input type="url" id="entreprise-site" placeholder="https://...">
            </div>
            
            <button class="btn" onclick="navigateToTab(2)">Continuer vers les ressources</button>
        </div>
        
        <!-- SECTION 2: RESSOURCES DISPONIBLES -->
        <div class="section tab-content" id="tab-2">
            <div class="section-header">
                <h2 class="section-title">Ressources disponibles</h2>
            </div>
            
            <p>Sélectionnez les ressources que votre entreprise peut mettre à disposition d'autres entreprises.</p>
            
            <div class="category-group">
                <h3>Espaces et Locaux</h3>
                <select id="select-espace" onchange="handleResourceSelection(this, 'ressources')">
                    <option value="">-- Sélectionnez un espace --</option>
                    <option value="Bureau partagé">Bureau partagé</option>
                    <option value="Espace de coworking">Espace de coworking</option>
                    <option value="Salle de réunion">Salle de réunion</option>
                    <option value="Espace d'événement">Espace d'événement</option>
                    <option value="Espace de stockage">Espace de stockage</option>
                    <option value="Atelier">Atelier</option>
                    <option value="Cuisine professionnelle">Cuisine professionnelle</option>
                    <option value="Laboratoire">Laboratoire</option>
                    <option value="Parking">Parking</option>
                    <option value="Surface extérieure">Surface extérieure</option>
                    <option value="Local commercial">Local commercial</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-espace" class="other-field">
                    <label for="espace-autre">Précisez l'espace *</label>
                    <input type="text" id="espace-autre" onblur="addCustomResource('espace-autre', 'ressources')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Équipements et Matériel</h3>
                <select id="select-equipement" onchange="handleResourceSelection(this, 'ressources')">
                    <option value="">-- Sélectionnez un équipement --</option>
                    <option value="Matériel informatique">Matériel informatique</option>
                    <option value="Imprimante / Scanner">Imprimante / Scanner</option>
                    <option value="Vidéoprojecteur">Vidéoprojecteur</option>
                    <option value="Machine-outil">Machine-outil</option>
                    <option value="Équipement de manutention">Équipement de manutention</option>
                    <option value="Véhicule professionnel">Véhicule professionnel</option>
                    <option value="Équipement audio/vidéo">Équipement audio/vidéo</option>
                    <option value="Matériel événementiel">Matériel événementiel</option>
                    <option value="Mobilier de bureau">Mobilier de bureau</option>
                    <option value="Outillage spécialisé">Outillage spécialisé</option>
                    <option value="Équipement médical">Équipement médical</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-equipement" class="other-field">
                    <label for="equipement-autre">Précisez l'équipement *</label>
                    <input type="text" id="equipement-autre" onblur="addCustomResource('equipement-autre', 'ressources')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Ressources Humaines et Compétences</h3>
                <select id="select-competence" onchange="handleResourceSelection(this, 'ressources')">
                    <option value="">-- Sélectionnez une compétence --</option>
                    <option value="Expertise comptable">Expertise comptable</option>
                    <option value="Compétences juridiques">Compétences juridiques</option>
                    <option value="Développement informatique">Développement informatique</option>
                    <option value="Design / Graphisme">Design / Graphisme</option>
                    <option value="Communication / Marketing">Communication / Marketing</option>
                    <option value="Traduction">Traduction</option>
                    <option value="Conseil en stratégie">Conseil en stratégie</option>
                    <option value="Formation professionnelle">Formation professionnelle</option>
                    <option value="Gestion de projet">Gestion de projet</option>
                    <option value="Ressources humaines">Ressources humaines</option>
                    <option value="Maintenance technique">Maintenance technique</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-competence" class="other-field">
                    <label for="competence-autre">Précisez la compétence *</label>
                    <input type="text" id="competence-autre" onblur="addCustomResource('competence-autre', 'ressources')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Matières et Ressources Matérielles</h3>
                <select id="select-matiere" onchange="handleResourceSelection(this, 'ressources')">
                    <option value="">-- Sélectionnez une matière --</option>
                    <option value="Matières premières">Matières premières</option>
                    <option value="Matériaux recyclés">Matériaux recyclés</option>
                    <option value="Emballages">Emballages</option>
                    <option value="Palettes">Palettes</option>
                    <option value="Chutes de production">Chutes de production</option>
                    <option value="Papier / Carton">Papier / Carton</option>
                    <option value="Textiles">Textiles</option>
                    <option value="Bois">Bois</option>
                    <option value="Métaux">Métaux</option>
                    <option value="Plastiques">Plastiques</option>
                    <option value="Produits chimiques">Produits chimiques</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-matiere" class="other-field">
                    <label for="matiere-autre">Précisez la matière *</label>
                    <input type="text" id="matiere-autre" onblur="addCustomResource('matiere-autre', 'ressources')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Services</h3>
                <select id="select-service" onchange="handleResourceSelection(this, 'ressources')">
                    <option value="">-- Sélectionnez un service --</option>
                    <option value="Livraison / Transport">Livraison / Transport</option>
                    <option value="Accueil / Réception">Accueil / Réception</option>
                    <option value="Services administratifs">Services administratifs</option>
                    <option value="Nettoyage">Nettoyage</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Sécurité">Sécurité</option>
                    <option value="Restauration collective">Restauration collective</option>
                    <option value="Services informatiques">Services informatiques</option>
                    <option value="Gestion déchets">Gestion déchets</option>
                    <option value="Conciergerie">Conciergerie</option>
                    <option value="Formation">Formation</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-service" class="other-field">
                    <label for="service-autre">Précisez le service *</label>
                    <input type="text" id="service-autre" onblur="addCustomResource('service-autre', 'ressources')">
                </div>
            </div>
            
            <h3>Ressources sélectionnées</h3>
            <div id="ressources-selected" class="selected-items"></div>
            
            <div class="form-group">
                <label for="ressources-details">Informations complémentaires (optionnel)</label>
                <textarea id="ressources-details" placeholder="Précisez des détails sur les ressources disponibles, conditions, quantités, fréquence..."></textarea>
            </div>
            
            <div class="form-row">
                <button class="btn" onclick="navigateToTab(1)" style="background-color: #888;">Retour</button>
                <button class="btn" onclick="navigateToTab(3)">Continuer vers les besoins</button>
            </div>
        </div>
        
        <!-- SECTION 3: BESOINS RECHERCHÉS -->
        <div class="section tab-content" id="tab-3">
            <div class="section-header">
                <h2 class="section-title">Besoins recherchés</h2>
            </div>
            
            <p>Sélectionnez les besoins que votre entreprise recherche auprès d'autres entreprises.</p>
            
            <div class="category-group">
                <h3>Espaces et Locaux</h3>
                <select id="select-espace-besoin" onchange="handleResourceSelection(this, 'besoins')">
                    <option value="">-- Sélectionnez un espace --</option>
                    <option value="Bureau partagé">Bureau partagé</option>
                    <option value="Espace de coworking">Espace de coworking</option>
                    <option value="Salle de réunion">Salle de réunion</option>
                    <option value="Espace d'événement">Espace d'événement</option>
                    <option value="Espace de stockage">Espace de stockage</option>
                    <option value="Atelier">Atelier</option>
                    <option value="Cuisine professionnelle">Cuisine professionnelle</option>
                    <option value="Laboratoire">Laboratoire</option>
                    <option value="Parking">Parking</option>
                    <option value="Surface extérieure">Surface extérieure</option>
                    <option value="Local commercial">Local commercial</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-espace-besoin" class="other-field">
                    <label for="espace-besoin-autre">Précisez l'espace *</label>
                    <input type="text" id="espace-besoin-autre" onblur="addCustomResource('espace-besoin-autre', 'besoins')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Équipements et Matériel</h3>
                <select id="select-equipement-besoin" onchange="handleResourceSelection(this, 'besoins')">
                    <option value="">-- Sélectionnez un équipement --</option>
                    <option value="Matériel informatique">Matériel informatique</option>
                    <option value="Imprimante / Scanner">Imprimante / Scanner</option>
                    <option value="Vidéoprojecteur">Vidéoprojecteur</option>
                    <option value="Machine-outil">Machine-outil</option>
                    <option value="Équipement de manutention">Équipement de manutention</option>
                    <option value="Véhicule professionnel">Véhicule professionnel</option>
                    <option value="Équipement audio/vidéo">Équipement audio/vidéo</option>
                    <option value="Matériel événementiel">Matériel événementiel</option>
                    <option value="Mobilier de bureau">Mobilier de bureau</option>
                    <option value="Outillage spécialisé">Outillage spécialisé</option>
                    <option value="Équipement médical">Équipement médical</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-equipement-besoin" class="other-field">
                    <label for="equipement-besoin-autre">Précisez l'équipement *</label>
                    <input type="text" id="equipement-besoin-autre" onblur="addCustomResource('equipement-besoin-autre', 'besoins')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Ressources Humaines et Compétences</h3>
                <select id="select-competence-besoin" onchange="handleResourceSelection(this, 'besoins')">
                    <option value="">-- Sélectionnez une compétence --</option>
                    <option value="Expertise comptable">Expertise comptable</option>
                    <option value="Compétences juridiques">Compétences juridiques</option>
                    <option value="Développement informatique">Développement informatique</option>
                    <option value="Design / Graphisme">Design / Graphisme</option>
                    <option value="Communication / Marketing">Communication / Marketing</option>
                    <option value="Traduction">Traduction</option>
                    <option value="Conseil en stratégie">Conseil en stratégie</option>
                    <option value="Formation professionnelle">Formation professionnelle</option>
                    <option value="Gestion de projet">Gestion de projet</option>
                    <option value="Ressources humaines">Ressources humaines</option>
                    <option value="Maintenance technique">Maintenance technique</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-competence-besoin" class="other-field">
                    <label for="competence-besoin-autre">Précisez la compétence *</label>
                    <input type="text" id="competence-besoin-autre" onblur="addCustomResource('competence-besoin-autre', 'besoins')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Matières et Ressources Matérielles</h3>
                <select id="select-matiere-besoin" onchange="handleResourceSelection(this, 'besoins')">
                    <option value="">-- Sélectionnez une matière --</option>
                    <option value="Matières premières">Matières premières</option>
                    <option value="Matériaux recyclés">Matériaux recyclés</option>
                    <option value="Emballages">Emballages</option>
                    <option value="Palettes">Palettes</option>
                    <option value="Chutes de production">Chutes de production</option>
                    <option value="Papier / Carton">Papier / Carton</option>
                    <option value="Textiles">Textiles</option>
                    <option value="Bois">Bois</option>
                    <option value="Métaux">Métaux</option>
                    <option value="Plastiques">Plastiques</option>
                    <option value="Produits chimiques">Produits chimiques</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-matiere-besoin" class="other-field">
                    <label for="matiere-besoin-autre">Précisez la matière *</label>
                    <input type="text" id="matiere-besoin-autre" onblur="addCustomResource('matiere-besoin-autre', 'besoins')">
                </div>
            </div>
            
            <div class="category-group">
                <h3>Services</h3>
                <select id="select-service-besoin" onchange="handleResourceSelection(this, 'besoins')">
                    <option value="">-- Sélectionnez un service --</option>
                    <option value="Livraison / Transport">Livraison / Transport</option>
                    <option value="Accueil / Réception">Accueil / Réception</option>
                    <option value="Services administratifs">Services administratifs</option>
                    <option value="Nettoyage">Nettoyage</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Sécurité">Sécurité</option>
                    <option value="Restauration collective">Restauration collective</option>
                    <option value="Services informatiques">Services informatiques</option>
                    <option value="Gestion déchets">Gestion déchets</option>
                    <option value="Conciergerie">Conciergerie</option>
                    <option value="Formation">Formation</option>
                    <option value="Autre">Autre...</option>
                </select>
                <div id="autre-service-besoin" class="other-field">
                    <label for="service-besoin-autre">Précisez le service *</label>
                    <input type="text" id="service-besoin-autre" onblur="addCustomResource('service-besoin-autre', 'besoins')">
                </div>
            </div>
            
            <h3>Besoins sélectionnés</h3>
            <div id="besoins-selected" class="selected-items"></div>
            
            <div class="form-group">
                <label for="besoins-details">Informations complémentaires (optionnel)</label>
                <textarea id="besoins-details" placeholder="Précisez des détails sur vos besoins, quantités souhaitées, fréquence, etc."></textarea>
            </div>
            
            <div class="form-row">
                <button class="btn" onclick="navigateToTab(2)" style="background-color: #888;">Retour</button>
                <button class="btn" onclick="navigateToTab(4)">Continuer vers les notifications</button>
            </div>
        </div>
        
        <!-- SECTION 4: PRÉFÉRENCES DE NOTIFICATION -->
        <div class="section tab-content" id="tab-4">
            <div class="section-header">
                <h2 class="section-title">Préférences de notification</h2>
            </div>
            
            <p>Paramétrez vos préférences de notification pour être informé des correspondances potentielles.</p>
            
            <div class="form-group">
                <label>Recevoir des notifications par email</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="notif-email-oui" name="notif-email" value="oui" checked>
                        <label for="notif-email-oui">Oui</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="notif-email-non" name="notif-email" value="non">
                        <label for="notif-email-non">Non</label>
                    </div>
                </div>
            </div>
            
            <div class="notification-settings">
                <div class="form-group">
                    <label for="notif-email-adresse">Email pour les notifications</label>
                    <input type="email" id="notif-email-adresse">
                </div>
                
                <div class="form-group">
                    <label>Fréquence des notifications</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="freq-immediate" name="notif-frequence" value="immediate" checked>
                            <label for="freq-immediate">Immédiate</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="freq-quotidienne" name="notif-frequence" value="quotidienne">
                            <label for="freq-quotidienne">Quotidienne</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="freq-hebdomadaire" name="notif-frequence" value="hebdomadaire">
                            <label for="freq-hebdomadaire">Hebdomadaire</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Types de notifications</label>
                    <div class="form-group">
                        <div class="radio-option">
                            <input type="checkbox" id="notif-type-match" checked>
                            <label for="notif-type-match">Nouvelles correspondances</label>
                        </div>
                        <div class="radio-option">
                            <input type="checkbox" id="notif-type-message" checked>
                            <label for="notif-type-message">Messages reçus</label>
                        </div>
                        <div class="radio-option">
                            <input type="checkbox" id="notif-type-actualite">
                            <label for="notif-type-actualite">Actualités et événements Ré(GE)nère</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>Visibilité de votre profil</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="visibilite-public" name="profil-visibilite" value="public" checked>
                        <label for="visibilite-public">Public (visible par toutes les entreprises)</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="visibilite-prive" name="profil-visibilite" value="prive">
                        <label for="visibilite-prive">Privé (visible uniquement en cas de correspondance)</label>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <button class="btn" onclick="navigateToTab(3)" style="background-color: #888;">Retour</button>
                <button class="btn" onclick="submitForm()">Enregistrer</button>
            </div>
        </div>
    </div>

    <script>
        // Variables pour la vérification du cache
        let cacheVersion = "1.0.5";
        let lastUpdateTimestamp = new Date().getTime();
        
        // Listes pour stocker les sélections
        let ressourcesList = [];
        let besoinsList = [];
        
        // Vérifier si un rechargement forcé est nécessaire au chargement
        window.onload = function() {
            checkCacheStatus();
        };
        
        // Fonction pour vérifier le statut du cache
        function checkCacheStatus() {
            // Générer un identifiant unique pour cette session
            if (!sessionStorage.getItem('sessionId')) {
                sessionStorage.setItem('sessionId', new Date().getTime());
            }
            
            // Vérifier si c'est la première visite ou un rechargement
            if (!sessionStorage.getItem('cacheChecked')) {
                sessionStorage.setItem('cacheChecked', 'true');
                document.getElementById('cacheAlert').style.display = 'block';
            } else {
                document.getElementById('cacheAlert').style.display = 'none';
            }
            
            // Vérifier la version du cache stockée
            if (localStorage.getItem('cacheVersion') !== cacheVersion) {
                localStorage.setItem('cacheVersion', cacheVersion);
                document.getElementById('cacheStatus').textContent = 'Nouvelle version disponible: ' + cacheVersion;
                document.getElementById('cacheStatus').className = 'cache-status problem';
            } else {
                document.getElementById('cacheStatus').textContent = 'Version à jour: ' + cacheVersion;
                document.getElementById('cacheStatus').className = 'cache-status ok';
                document.getElementById('cacheAlert').classList.remove('critical');
            }
        }
        
        // Fonction pour forcer le rechargement de la page
        function forceCacheRefresh() {
            // Effacer les données de cache local
            localStorage.removeItem('cacheVersion');
            
            // Utiliser un paramètre timestamp unique pour forcer le rechargement
            const timestamp = new Date().getTime();
            window.location.href = window.location.pathname + '?nocache=' + timestamp;
        }
        
        // Fonction pour fermer l'alerte de cache
        function dismissCacheAlert() {
            document.getElementById('cacheAlert').style.display = 'none';
        }
        
        // Fonction pour naviguer entre les onglets
        function navigateToTab(tabNumber) {
            // Masquer tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Afficher l'onglet sélectionné
            document.getElementById(`tab-${tabNumber}`).classList.add('active');
            
            // Mettre à jour l'indicateur de progression
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index + 1 === tabNumber) {
                    step.classList.add('active');
                } else if (index + 1 < tabNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }
        
        // Fonction pour gérer l'affichage du champ "Autre"
        function toggleOtherField(selectId, otherId) {
            const select = document.getElementById(selectId);
            const otherField = document.getElementById(otherId);
            
            if (select.value === "Autre") {
                otherField.style.display = "block";
            } else {
                otherField.style.display = "none";
            }
        }
        
        // Fonction pour gérer la sélection de ressources, y compris l'option "Autre"
        function handleResourceSelection(selectElement, listType) {
            if (selectElement.value === "Autre") {
                // Afficher le champ de texte pour l'entrée personnalisée
                const categoryId = selectElement.id.replace('select-', '').replace('-besoin', '');
                const otherFieldId = `autre-${categoryId}${listType === 'besoins' ? '-besoin' : ''}`;
                document.getElementById(otherFieldId).style.display = "block";
                
                // Ne pas ajouter "Autre" comme tag
                selectElement.value = "";
            } else if (selectElement.value !== "") {
                // Pour les options standard, ajouter directement un tag
                addSelectedItem(selectElement.id, listType);
            }
        }
        
        // Fonction pour ajouter une ressource personnalisée depuis un champ "Autre"
        function addCustomResource(inputId, listType) {
            const input = document.getElementById(inputId);
            if (input.value.trim() === "") return;
            
            const targetList = listType === 'ressources' ? ressourcesList : besoinsList;
            const targetElement = document.getElementById(`${listType}-selected`);
            
            const value = input.value.trim();
            
            // Ajouter seulement si l'élément n'est pas déjà dans la liste
            if (!targetList.includes(value)) {
                targetList.push(value);
                
                // Créer l'élément tag
                const tag = document.createElement('div');
                tag.className = 'tag';
                // Échapper les caractères spéciaux pour le HTML
                const escapedValue = value.replace(/[&<>"']/g, function(m) {
                    return {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#39;'
                    }[m];
                });
                tag.innerHTML = `${escapedValue} <span class="tag-remove" onclick="removeItem('${escapedValue}', '${listType}')">✕</span>`;
                targetElement.appendChild(tag);
                
                // Masquer le champ après l'ajout
                const categoryId = inputId.split('-')[0];
                const otherFieldId = `autre-${categoryId}${listType === 'besoins' ? '-besoin' : ''}`;
                document.getElementById(otherFieldId).style.display = "none";
                
                // Réinitialiser le champ
                input.value = "";
            }
        }
        
        // Fonction pour ajouter un élément sélectionné
        function addSelectedItem(selectId, listType) {
            const select = document.getElementById(selectId);
            const value = select.value;
            
            if (value === "") return;
            
            const targetList = listType === 'ressources' ? ressourcesList : besoinsList;
            const targetElement = document.getElementById(`${listType}-selected`);
            
            // Ajouter seulement si l'élément n'est pas déjà dans la liste
            if (!targetList.includes(value)) {
                targetList.push(value);
                
                // Créer l'élément tag
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = `${value} <span class="tag-remove" onclick="removeItem('${value}', '${listType}')">✕</span>`;
                targetElement.appendChild(tag);
            }
            
            // Réinitialiser l'élément select
            select.value = "";
        }
        
        // Fonction pour supprimer un élément
        function removeItem(value, listType) {
            const targetList = listType === 'ressources' ? ressourcesList : besoinsList;
            const targetElement = document.getElementById(`${listType}-selected`);
            
            // Supprimer de l'array
            const index = targetList.indexOf(value);
            if (index > -1) {
                targetList.splice(index, 1);
            }
            
            // Supprimer l'affichage visuel
            const tags = targetElement.getElementsByClassName('tag');
            for (let i = 0; i < tags.length; i++) {
                if (tags[i].textContent.includes(value)) {
                    targetElement.removeChild(tags[i]);
                    break;
                }
            }
        }
        
        // Fonction pour afficher/masquer les instructions de cache
        function toggleCacheInstructions() {
            const instructions = document.getElementById('cache-instructions');
            if (instructions.style.display === 'none') {
                instructions.style.display = 'block';
            } else {
                instructions.style.display = 'none';
            }
        }
        
        // Fonction pour simuler la soumission du formulaire
        function submitForm() {
            // Récupération des données du formulaire
            const secteur = document.getElementById('entreprise-secteur').value;
            const secteurValue = secteur === 'Autre' 
                ? document.getElementById('entreprise-secteur-autre').value 
                : secteur;
            
            const formData = {
                entreprise: {
                    nom: document.getElementById('entreprise-nom').value,
                    secteur: secteurValue,
                    taille: document.getElementById('entreprise-taille').value,
                    description: document.getElementById('entreprise-description').value,
                    adresse: document.getElementById('entreprise-adresse').value,
                    codePostal: document.getElementById('entreprise-code-postal').value,
                    ville: document.getElementById('entreprise-ville').value,
                    site: document.getElementById('entreprise-site').value
                },
                contact: {
                    nom: document.getElementById('contact-nom').value,
                    fonction: document.getElementById('contact-fonction').value,
                    email: document.getElementById('contact-email').value
                },
                ressources: {
                    liste: ressourcesList,
                    details: document.getElementById('ressources-details').value
                },
                besoins: {
                    liste: besoinsList,
                    details: document.getElementById('besoins-details').value
                },
                notifications: {
                    email: document.getElementById('notif-email-oui').checked,
                    adresse: document.getElementById('notif-email-adresse').value,
                    frequence: document.querySelector('input[name="notif-frequence"]:checked').value,
                    types: {
                        match: document.getElementById('notif-type-match').checked,
                        message: document.getElementById('notif-type-message').checked,
                        actualite: document.getElementById('notif-type-actualite').checked
                    }
                },
                visibilite: document.querySelector('input[name="profil-visibilite"]:checked').value
            };
            
            console.log('Données du formulaire:', formData);
            
            // Simulation d'envoi réussi
            alert('Votre profil a été enregistré avec succès ! Vous recevrez des notifications lorsque des correspondances seront trouvées.');
        }
    </script>
</body>
</html>
